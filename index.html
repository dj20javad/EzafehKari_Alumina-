<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>سامانه اضافه کاری آلومینا</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="theme-color" content="#0f172a">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { -webkit-tap-highlight-color: transparent; user-select: none; font-family: system-ui, -apple-system, sans-serif; background-color: #f8fafc; }
        input, textarea { user-select: text; }
        
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .tour-card { animation: fadeIn 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useLayoutEffect, useRef } = React;

        /* =========================================
           ICONS
           ========================================= */
        const iconPaths = {
            Calendar: "M19 4H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm-1-2v4M6 2v4M2 10h20",
            Clock: "M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20zM12 6v6l4 2",
            Save: "M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2zM17 21v-8H7v8M7 3v5h8",
            Trash2: "M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M10 11v6M14 11v6",
            Download: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3",
            Upload: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12",
            AlertTriangle: "M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0zM12 9v4M12 17h.01",
            User: "M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8z",
            FileText: "M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8zM14 2v6h6M16 13H8M16 17H8M10 9H8",
            Edit: "M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z",
            ChevronLeft: "M15 18l-6-6 6-6",
            ChevronRight: "M9 18l6-6-6-6",
            Settings: "M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2zM12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z",
            CheckCircle: "M22 11.08V12a10 10 0 1 1-5.93-9.14M2 4L12 14.01l-3-3",
            Sun: "M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42M12 17a5 5 0 1 0 0-10 5 5 0 0 0 0 10z",
            Briefcase: "M4 7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7zM9 7V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2",
            Factory: "M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v16z",
            Layers: "M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5",
            Sunrise: "M17 18a5 5 0 0 0-10 0M12 2v7M4.22 10.22l1.42 1.42M1 18h2M21 18h2M18.36 11.64l1.42-1.42M23 22H1M8 6l4-4 4 4",
            Sunset: "M17 18a5 5 0 0 0-10 0M12 9V2M4.22 10.22l1.42 1.42M1 18h2M21 18h2M18.36 11.64l1.42-1.42M23 22H1M16 5l-4 4-4-4",
            Moon: "M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z",
            X: "M18 6L6 18M6 6l12 12",
            AlertCircle: "M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20zM12 8v4M12 16h.01",
            Lock: "M19 11H5a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2zm-7 7v-2m3-9a3 3 0 0 0-6 0v4h6V6z",
            Crown: "M2 4l3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",
            CreditCard: "M22 11.08V12a10 10 0 1 1-5.93-9.14M2 10h20M7 15h1",
            Loader2: "M21 12a9 9 0 1 1-6.219-8.56",
            Flag: "M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1zM4 22v-7",
            Coffee: "M18 8h1a4 4 0 0 1 0 8h-1M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8zM6 1v3M10 1v3M14 1v3",
            Gift: "M20 12v10H4V12M2 7h20v5H2zM12 22V7M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7zM12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z",
            HelpCircle: "M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20zM9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3M12 17h.01",
            ArrowLeft: "M19 12H5M12 19l-7-7 7-7",
            ArrowRight: "M5 12h14M12 5l7 7-7 7",
            Sparkles: "M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
        };

        const Icon = ({ name, size = 24, className = "" }) => {
            const path = iconPaths[name];
            if (!path) return null;
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d={path} />
                </svg>
            );
        };

        const WhatsAppIcon = () => (
          <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor" className="text-white">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
          </svg>
        );

        const callGemini = async (prompt) => {
            try {
                await new Promise(r => setTimeout(r, 1500));
                return "تحلیل هوشمند نمونه:\n\n* **کارکرد:** مطلوب\n* **پیشنهاد:** برای حفظ سلامتی، در روزهای استراحت کمتر اضافه کاری کنید.";
            } catch (error) {
                return "خطا در ارتباط.";
            }
        };

        const jalaali = {
          toJalaali: (gy, gm, gd) => {
            const g_d_m = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];
            let jy = (gy <= 1600) ? 0 : 979;
            gy -= (gy <= 1600) ? 621 : 1600;
            const gy2 = (gm > 2) ? (gy + 1) : gy;
            let days = (365 * gy) + parseInt((gy2 + 3) / 4) - parseInt((gy2 + 99) / 100) + parseInt((gy2 + 399) / 400) - 80 + gd + g_d_m[gm - 1];
            jy += 33 * parseInt(days / 12053);
            days %= 12053;
            jy += 4 * parseInt(days / 1461);
            days %= 1461;
            jy += parseInt((days - 1) / 365);
            if (days > 365) days = (days - 1) % 365;
            const jm = (days < 186) ? 1 + parseInt(days / 31) : 7 + parseInt((days - 186) / 30);
            const jd = 1 + ((days < 186) ? (days % 31) : ((days - 186) % 30));
            return { jy, jm, jd };
          },
          toGregorian: (jy, jm, jd) => {
            let gy = (jy <= 979) ? 621 : 1600;
            jy -= (jy <= 979) ? 0 : 979;
            let days = (365 * jy) + ((parseInt(jy / 33) * 8) + parseInt(((jy % 33) + 3) / 4)) + 78 + jd + ((jm < 7) ? (jm - 1) * 31 : ((jm - 7) * 30) + 186);
            gy += 400 * parseInt(days / 146097);
            days %= 146097;
            if (days > 36524) {
              gy += 100 * parseInt(--days / 36524);
              days %= 36524;
              if (days >= 365) days++;
            }
            gy += 4 * parseInt(days / 1461);
            days %= 1461;
            gy += parseInt((days - 1) / 365);
            if (days > 365) days = (days - 1) % 365;
            let gd = days + 1;
            const sal_a = [0, 31, ((gy % 4 === 0 && gy % 100 !== 0) || (gy % 400 === 0)) ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            let gm;
            for (gm = 0; gm < 13; gm++) {
              const v = sal_a[gm];
              if (gd <= v) break;
              gd -= v;
            }
            return { gy, gm, gd };
          },
          monthNames: ["فروردین", "اردیبهشت", "خرداد", "تیر", "مرداد", "شهریور", "مهر", "آبان", "آذر", "دی", "بهمن", "اسفند"]
        };

        const getTodayJalali = () => {
          const now = new Date();
          return jalaali.toJalaali(now.getFullYear(), now.getMonth() + 1, now.getDate());
        };

        const formatJalaliNoYear = (jDate) => `${jDate.jd} ${jalaali.monthNames[jDate.jm - 1]}`;

        /* =========================================
           UI COMPONENTS
           ========================================= */

        const JalaliDatePicker = ({ value, onChange, startYear = 1400, endYear = 1405 }) => {
          const days = Array.from({ length: 31 }, (_, i) => i + 1);
          const years = Array.from({ length: endYear - startYear + 1 }, (_, i) => startYear + i);
          
          const safeOnChange = (newVal) => {
              if(onChange) onChange(newVal);
          };

          return (
            <div className="flex gap-1 items-center bg-white border border-gray-300 rounded-lg p-1 shadow-sm" dir="rtl">
              <select value={value.jd} onChange={(e) => safeOnChange({ ...value, jd: parseInt(e.target.value) })} className="bg-transparent font-bold p-1 outline-none text-sm appearance-none cursor-pointer text-center w-12 hover:bg-gray-50 rounded">
                {days.map(d => <option key={d} value={d}>{d}</option>)}
              </select>
              <span className="text-gray-400">/</span>
              <select value={value.jm} onChange={(e) => safeOnChange({ ...value, jm: parseInt(e.target.value) })} className="bg-transparent font-bold p-1 outline-none text-sm appearance-none cursor-pointer text-center w-24 hover:bg-gray-50 rounded">
                {jalaali.monthNames.map((m, i) => <option key={i} value={i + 1}>{m}</option>)}
              </select>
              <span className="text-gray-400">/</span>
              <select value={value.jy} onChange={(e) => safeOnChange({ ...value, jy: parseInt(e.target.value) })} className="bg-transparent font-bold p-1 outline-none text-sm appearance-none cursor-pointer text-center w-16 hover:bg-gray-50 rounded">
                {years.map(y => <option key={y} value={y}>{y}</option>)}
              </select>
            </div>
          );
        };

        const ConfirmModal = ({ isOpen, title, message, onConfirm, onCancel, confirmText = "بله، حذف شود", cancelText = "انصراف" }) => {
          if (!isOpen) return null;
          return (
            <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
              <div className="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in duration-200">
                <div className="p-6 text-center">
                  <div className="w-16 h-16 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <Icon name="AlertCircle" size={32} />
                  </div>
                  <h3 className="text-xl font-bold text-gray-800 mb-2">{title}</h3>
                  <p className="text-gray-500 mb-6 text-sm leading-relaxed">{message}</p>
                  <div className="flex gap-3">
                    <button onClick={onCancel} className="flex-1 py-3 px-4 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold rounded-xl transition-colors">{cancelText}</button>
                    <button onClick={onConfirm} className="flex-1 py-3 px-4 bg-red-600 hover:bg-red-700 text-white font-bold rounded-xl shadow-lg shadow-red-200 transition-colors">{confirmText}</button>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        const PaymentModal = ({ isOpen, onClose, onSuccess }) => {
          const [loading, setLoading] = useState(false);
          const handlePayment = () => { setLoading(true); setTimeout(() => { setLoading(false); onSuccess(); }, 3000); };
          if (!isOpen) return null;
          return (
            <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm">
              <div className="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in duration-200 relative">
                <button onClick={onClose} className="absolute left-4 top-4 text-gray-400 hover:text-gray-600"><Icon name="X" size={24}/></button>
                <div className="p-6 text-center">
                  <div className="w-20 h-20 bg-gradient-to-br from-yellow-100 to-amber-100 text-amber-600 rounded-full flex items-center justify-center mx-auto mb-4 border-4 border-white shadow-xl"><Icon name="Crown" size={40} fill="currentColor" className="text-amber-500"/></div>
                  <h3 className="text-2xl font-black text-gray-800 mb-2">ارتقاء به نسخه ویژه</h3>
                  <p className="text-gray-500 mb-6 text-sm leading-relaxed">در نسخه رایگان تنها امکان ثبت <span className="font-bold text-red-500">۳ رکورد</span> وجود دارد. برای ثبت نامحدود لطفا اشتراک تهیه کنید.</p>
                  <div className="bg-slate-50 rounded-xl p-4 mb-6 border border-slate-100">
                     <div className="flex justify-between items-center mb-2"><span className="text-sm text-gray-600">مبلغ قابل پرداخت:</span><span className="font-bold text-lg text-slate-800">۵۰,۰۰۰ <span className="text-xs text-gray-500">تومان</span></span></div>
                     <div className="h-px bg-slate-200 my-2"></div>
                     <div className="flex items-center justify-center gap-2 text-xs text-emerald-600 font-bold bg-emerald-50 py-1 rounded"><Icon name="CheckCircle" size={12}/> پرداخت امن زرین پال (شبیه‌سازی)</div>
                  </div>
                  <button onClick={handlePayment} disabled={loading} className="w-full py-4 bg-gradient-to-r from-slate-900 to-slate-800 hover:from-slate-800 hover:to-slate-700 text-white font-bold rounded-xl shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2">
                    {loading ? <><Icon name="Loader2" size={20} className="animate-spin"/> درحال انتقال به درگاه...</> : <><Icon name="CreditCard" size={20}/> پرداخت و فعال‌سازی آنی</>}
                  </button>
                </div>
              </div>
            </div>
          );
        };

        const AIModal = ({ isOpen, onClose, content, loading }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[150] flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-lg h-[80vh] flex flex-col overflow-hidden animate-in fade-in zoom-in duration-200">
                        <div className="p-4 border-b flex justify-between items-center bg-slate-50">
                            <h3 className="font-bold text-slate-800 flex items-center gap-2">
                                <Icon name="Sparkles" className="text-purple-600" />
                                تحلیل هوشمند عملکرد
                            </h3>
                            <button onClick={onClose}><Icon name="X" className="text-slate-400 hover:text-slate-600" /></button>
                        </div>
                        <div className="p-6 overflow-y-auto flex-1 ai-content">
                            {loading ? (
                                <div className="flex flex-col items-center justify-center h-full gap-4 text-slate-500">
                                    <Icon name="Loader2" size={48} className="animate-spin text-purple-600" />
                                    <p>هوش مصنوعی در حال تحلیل سوابق شماست...</p>
                                </div>
                            ) : (
                                <div dangerouslySetInnerHTML={{ __html: typeof marked !== 'undefined' ? marked.parse(content) : content }} />
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const TourGuide = ({ steps, activeStep, isOpen, onClose, onNext, onPrev }) => {
          const [targetRect, setTargetRect] = useState(null);
          const [position, setPosition] = useState('bottom');
          const currentStep = steps[activeStep];

          useLayoutEffect(() => {
            if (!isOpen || !currentStep) return;
            const updateLayout = () => {
                const element = document.getElementById(currentStep.target);
                if (element) {
                    const rect = element.getBoundingClientRect();
                    const windowHeight = window.innerHeight;
                    const spaceBelow = windowHeight - rect.bottom;
                    const spaceAbove = rect.top;
                    const shouldShowTop = spaceBelow < 250 && spaceAbove > 250;
                    setPosition(shouldShowTop ? 'top' : 'bottom');
                    setTargetRect({
                        top: rect.top - 8,
                        left: rect.left - 8,
                        width: rect.width + 16,
                        height: rect.height + 16
                    });
                    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            };
            updateLayout();
            window.addEventListener('resize', updateLayout);
            return () => window.removeEventListener('resize', updateLayout);
          }, [isOpen, activeStep, currentStep]);

          if (!isOpen || !targetRect) return null;

          return (
            <div className="fixed inset-0 z-[999] overflow-hidden">
                <div 
                    className="absolute transition-all duration-300 ease-out rounded-xl pointer-events-none"
                    style={{
                        top: targetRect.top,
                        left: targetRect.left,
                        width: targetRect.width,
                        height: targetRect.height,
                        boxShadow: '0 0 0 9999px rgba(0, 0, 0, 0.75)',
                        border: '2px solid rgba(255, 255, 255, 0.5)'
                    }}
                />
                <div 
                    className="tour-card absolute z-[1000] bg-white p-5 rounded-2xl shadow-2xl max-w-xs w-full"
                    style={{
                        left: Math.min(Math.max(16, targetRect.left + (targetRect.width/2) - 160), window.innerWidth - 336),
                        top: position === 'bottom' ? targetRect.top + targetRect.height + 16 : 'auto',
                        bottom: position === 'top' ? (window.innerHeight - targetRect.top) + 16 : 'auto'
                    }}
                >
                    <div className="flex items-center gap-3 mb-3">
                        <div className="p-2 bg-blue-50 rounded-lg text-blue-600"><Icon name={currentStep.icon} /></div>
                        <h4 className="font-bold text-gray-800">{currentStep.title}</h4>
                    </div>
                    <p className="text-gray-600 text-sm leading-relaxed mb-4">{currentStep.desc}</p>
                    <div className="flex justify-between items-center">
                        <div className="flex gap-1">
                            {steps.map((_, idx) => (
                                <div key={idx} className={`w-1.5 h-1.5 rounded-full ${idx === activeStep ? 'bg-blue-600' : 'bg-gray-300'}`}/>
                            ))}
                        </div>
                        <div className="flex gap-2">
                            <button onClick={onClose} className="text-xs text-gray-400 hover:text-gray-600 font-bold px-2">انصراف</button>
                            <button onClick={onNext} className="bg-slate-900 text-white text-xs px-4 py-2 rounded-lg font-bold hover:bg-slate-800 transition-colors">
                                {activeStep === steps.length - 1 ? 'پایان' : 'بعدی'}
                            </button>
                        </div>
                    </div>
                    <div 
                        className="absolute w-4 h-4 bg-white rotate-45"
                        style={{
                            left: '50%',
                            marginLeft: '-8px',
                            top: position === 'bottom' ? -8 : 'auto',
                            bottom: position === 'top' ? -8 : 'auto',
                            boxShadow: position === 'bottom' ? '-4px -4px 4px -4px rgba(0,0,0,0.1)' : '4px 4px 4px -4px rgba(0,0,0,0.1)'
                        }}
                    ></div>
                </div>
            </div>
          );
        };

        const Header = ({ section, isPremium, onSettingsClick, onPaymentClick, onHelpClick }) => (
          <header className="bg-slate-900 text-white shadow-lg border-b-4 border-orange-500 sticky top-0 z-50">
            <div className="max-w-4xl mx-auto px-4 py-3 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="bg-white p-1.5 rounded-full shadow-lg relative">
                    <img 
                    src="https://raw.githubusercontent.com/dj20javad/Ezafeh_Kari/main/logo.png" 
                    alt="Logo" 
                    className="w-10 h-10 object-contain"
                    onError={(e) => {e.target.src = 'https://via.placeholder.com/64?text=Logo'}}
                    />
                    {isPremium && (
                        <div className="absolute -top-1 -right-1 bg-amber-400 text-white rounded-full p-0.5 border-2 border-slate-900">
                            <Icon name="Crown" size={10} fill="currentColor"/>
                        </div>
                    )}
                </div>
                <div>
                  <h1 className="text-base font-black tracking-tight">شرکت آلومینا ایران</h1>
                  <div className="flex items-center gap-1 text-xs opacity-80 font-light mt-0.5">
                    {section === 'factory' ? <Icon name="Factory" size={12}/> : <Icon name="Layers" size={12}/>}
                    <span>مجموعه {section === 'factory' ? 'کارخانه' : 'شمش'}</span>
                    <span className="mx-1">|</span>
                    <span>جاجرم</span>
                  </div>
                </div>
              </div>
              <div className="flex items-center gap-2">
                  <button id="tour-help-btn" onClick={onHelpClick} className="p-2 bg-white/10 rounded-xl hover:bg-white/20 transition-colors text-xs flex items-center justify-center text-white" title="راهنما"><Icon name="HelpCircle" size={18}/></button>
                  <div onClick={onPaymentClick} className={`text-[10px] px-2 py-1 rounded-lg border font-bold flex items-center gap-1 cursor-pointer transition-colors ${isPremium ? 'bg-amber-500/10 text-amber-400 border-amber-500/20' : 'bg-white/10 text-gray-400 border-white/10 hover:bg-white/20'}`}>
                    {isPremium ? <><Icon name="Crown" size={12}/> نسخه ویژه</> : <><Icon name="Lock" size={12}/> نسخه رایگان</>}
                  </div>
                  <button id="tour-settings-btn" onClick={onSettingsClick} className="p-2 bg-white/10 rounded-xl hover:bg-white/20 transition-colors text-xs flex flex-col items-center gap-1 backdrop-blur-md">
                    <Icon name="Settings" size={18}/>
                  </button>
              </div>
            </div>
          </header>
        );

        const Dashboard = ({ totalHours, maxOvertime, shiftType, isWarning, isDanger, recordCount, isPremium, onAIAnalyze }) => (
          <div id="tour-dashboard" className="bg-white rounded-2xl shadow-sm border border-slate-200 p-5 relative overflow-hidden">
            <div className="flex justify-between items-center mb-4 relative z-10">
              <h2 className="text-lg font-bold text-slate-700">وضعیت دوره جاری</h2>
              <button onClick={onAIAnalyze} className="flex items-center gap-1.5 px-3 py-1 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-full text-xs font-bold shadow-md hover:shadow-lg transition-all active:scale-95">
                <Icon name="Sparkles" size={14} className="text-yellow-300" />
                تحلیل
              </button>
            </div>
            {isWarning && <div className="flex items-center gap-1 text-orange-600 animate-pulse font-bold text-xs bg-orange-50 px-3 py-1.5 rounded-full border border-orange-100 mb-2"><Icon name="AlertTriangle" size={14}/><span>نزدیک به سقف</span></div>}
            {isDanger && <div className="flex items-center gap-1 text-red-600 font-bold text-xs bg-red-50 px-3 py-1.5 rounded-full border border-red-100 mb-2"><Icon name="AlertCircle" size={14}/><span>تکمیل سقف</span></div>}
            
            <div className="w-full bg-slate-100 rounded-full h-8 mb-6 relative overflow-hidden shadow-inner border border-slate-200">
              <div className={`h-full rounded-full transition-all duration-700 ease-out flex items-center justify-end pr-3 text-xs text-white font-bold shadow-lg ${isDanger ? 'bg-gradient-to-r from-red-500 to-red-600' : isWarning ? 'bg-gradient-to-r from-orange-400 to-orange-500' : 'bg-gradient-to-r from-emerald-400 to-emerald-500'}`} style={{ width: `${Math.min((totalHours / maxOvertime) * 100, 100)}%` }}></div>
              <div className="absolute inset-0 flex items-center justify-center text-xs font-black text-slate-700 z-10 drop-shadow-sm tracking-wide">{totalHours} از {maxOvertime} ساعت</div>
            </div>
            <div className="grid grid-cols-2 gap-3 text-center">
              <div className="bg-slate-50 p-3 rounded-xl border border-slate-100"><span className="block text-xs text-slate-400 mb-1">مجموع کارکرد</span><span className="text-xl font-black text-slate-800">{totalHours} <span className="text-xs font-normal text-slate-400">ساعت</span></span></div>
              <div className={`p-3 rounded-xl border ${isDanger ? 'bg-red-50 border-red-100' : 'bg-blue-50 border-blue-100'}`}><span className="block text-xs text-slate-400 mb-1">باقیمانده</span><span className={`text-xl font-black ${isDanger ? 'text-red-600' : 'text-blue-600'}`}>{Math.max(0, maxOvertime - totalHours).toFixed(2)} <span className="text-xs font-normal text-slate-400">ساعت</span></span></div>
              <div className="bg-emerald-50 p-3 rounded-xl border border-emerald-100"><span className="block text-xs text-slate-400 mb-1">پاداش ثابت</span><span className="text-xl font-black text-emerald-600">{(shiftType === '4shift' || shiftType === '5shift') ? '5' : '0'} <span className="text-xs font-normal text-slate-400">ساعت</span></span></div>
              <div className="bg-purple-50 p-3 rounded-xl border border-purple-100"><span className="block text-xs text-slate-400 mb-1">تعداد رکورد</span><span className="text-xl font-black text-purple-600">{recordCount} <span className="text-[10px] text-gray-400 font-normal">{!isPremium && '/3'}</span></span></div>
            </div>
          </div>
        );

        const RecordForm = ({ 
          selectedDate, currentShift, startTime, endTime, substitute, description, isNonRoutine, isHolidayBonus, editingId, shiftType,
          onChangeDate, setStartTime, setEndTime, setSubstitute, setDescription, setIsNonRoutine, setIsHolidayBonus, onSave, onDateSelect,
          onAIGenerateDesc, loadingDesc
        }) => (
          <div id="tour-form" className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 relative">
            <div id="tour-date-picker" className="flex items-center justify-between mb-6 bg-slate-50 p-2 rounded-xl border border-slate-100 shadow-inner">
               <button onClick={() => onChangeDate(-1)} className="w-10 h-10 flex items-center justify-center bg-white shadow-sm rounded-lg hover:bg-slate-100 text-slate-600 transition-colors"><Icon name="ChevronRight" size={20}/></button>
               <div className="flex flex-col items-center gap-1">
                  <JalaliDatePicker value={selectedDate} onChange={onDateSelect} startYear={1402} endYear={1405} />
                  <div className={`flex items-center gap-1.5 text-xs px-3 py-1 rounded-full font-bold mt-1 shadow-sm transition-colors ${
                      currentShift.type === 'rest' ? 'bg-emerald-100 text-emerald-700' : 
                      currentShift.type === 'night' ? 'bg-slate-800 text-white' : 
                      currentShift.type === 'day' ? 'bg-amber-100 text-amber-800' :
                      currentShift.type === 'morning' ? 'bg-yellow-100 text-yellow-700' : 
                      'bg-blue-100 text-blue-700'
                  }`}>
                      {currentShift.type === 'night' && <Icon name="Moon" size={12}/>}
                      {currentShift.type === 'morning' && <Icon name="Sunrise" size={12}/>}
                      {currentShift.type === 'afternoon' && <Icon name="Sunset" size={12}/>}
                      {currentShift.type === 'day' && <Icon name="Sun" size={12}/>}
                      {currentShift.type === 'rest' && <Icon name="Coffee" size={12}/>}
                      {currentShift.name} {currentShift.isFirstRest && '(اول)'}
                  </div>
               </div>
               <button onClick={() => onChangeDate(1)} className="w-10 h-10 flex items-center justify-center bg-white shadow-sm rounded-lg hover:bg-slate-100 text-slate-600 transition-colors"><Icon name="ChevronLeft" size={20}/></button>
            </div>

            <div 
              onClick={() => setIsHolidayBonus(!isHolidayBonus)}
              className={`mb-6 p-4 rounded-xl flex items-center gap-4 cursor-pointer transition-all duration-200 border-2 ${isHolidayBonus ? 'bg-red-50 border-red-200 shadow-inner' : 'bg-white border-slate-100 hover:border-red-100 hover:bg-red-50/50'}`}
            >
                <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors ${isHolidayBonus ? 'border-red-500 bg-red-500 text-white' : 'border-slate-300 bg-white'}`}>
                  {isHolidayBonus && <Icon name="CheckCircle" size={16}/>}
                </div>
                <span className={`text-sm font-bold select-none ${isHolidayBonus ? 'text-red-700' : 'text-slate-600'}`}>تعطیل رسمی (۸ ساعت)</span>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div className="space-y-5">
                 <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-xs font-bold text-slate-500 mb-1.5 flex items-center gap-1"><Icon name="Clock" size={12}/> شروع (24h)</label>
                      <input type="time" dir="ltr" value={startTime} onChange={(e) => setStartTime(e.target.value)} className="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-center font-mono font-bold text-lg"/>
                    </div>
                    <div>
                      <label className="block text-xs font-bold text-slate-500 mb-1.5 flex items-center gap-1"><Icon name="Clock" size={12}/> پایان (24h)</label>
                      <input type="time" dir="ltr" value={endTime} onChange={(e) => setEndTime(e.target.value)} className="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-center font-mono font-bold text-lg"/>
                    </div>
                 </div>
                 <div>
                   <label className="block text-xs font-bold text-slate-500 mb-1.5">جانشین</label>
                   <div className="relative">
                      <div className="absolute right-3 top-3 text-slate-400"><Icon name="User" size={18}/></div>
                      <input type="text" placeholder="نام همکار (اختیاری)" className="w-full p-3 pr-10 border border-slate-200 rounded-xl bg-slate-50 text-sm focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none transition-all" value={substitute} onChange={(e) => setSubstitute(e.target.value)}/>
                   </div>
                 </div>
              </div>
              <div className="space-y-4">
                  <div>
                      <label className="block text-xs font-bold text-slate-500 mb-1.5 flex justify-between">
                          توضیحات
                          <button onClick={onAIGenerateDesc} disabled={loadingDesc} className="text-[10px] text-purple-600 bg-purple-50 px-2 py-0.5 rounded-full flex items-center gap-1 hover:bg-purple-100 transition-colors">
                              {loadingDesc ? <Icon name="Loader2" size={10} className="animate-spin"/> : <Icon name="Sparkles" size={10}/>}
                              هوش مصنوعی
                          </button>
                      </label>
                      <textarea className="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 h-[88px] resize-none text-sm focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none transition-all" placeholder="توضیحات تکمیلی..." value={description} onChange={(e) => setDescription(e.target.value)}></textarea>
                  </div>
                  <div onClick={() => setIsNonRoutine(!isNonRoutine)} className={`flex items-center gap-3 p-3 rounded-xl border cursor-pointer transition-colors select-none ${isNonRoutine ? 'bg-amber-50 border-amber-200' : 'bg-slate-50 border-slate-100 hover:bg-slate-100'}`}>
                      <div className={`w-5 h-5 rounded border flex items-center justify-center transition-colors ${isNonRoutine ? 'bg-amber-500 border-amber-500 text-white' : 'bg-white border-slate-300'}`}>
                           {isNonRoutine && <Icon name="CheckCircle" size={14}/>}
                      </div>
                      <label className={`text-xs font-bold cursor-pointer ${isNonRoutine ? 'text-amber-800' : 'text-slate-500'}`}>غیر روتین (مجوز سرپرست)</label>
                  </div>
              </div>
            </div>
            <button id="tour-submit-btn" onClick={onSave} className={`mt-6 w-full py-4 rounded-xl flex items-center justify-center gap-2 font-bold text-white shadow-lg transition-all active:scale-95 text-lg ${editingId ? 'bg-orange-500 hover:bg-orange-600 shadow-orange-200' : isHolidayBonus ? 'bg-red-600 hover:bg-red-700 shadow-red-200' : 'bg-slate-900 hover:bg-slate-800 shadow-slate-300'}`}>
              {editingId ? <><Icon name="Edit" size={20}/> بروزرسانی رکورد</> : isHolidayBonus ? <><Icon name="Sun" size={20}/> ثبت تعطیلی</> : <><Icon name="Save" size={20}/> ثبت در لیست</>}
            </button>
          </div>
        );

        const RecordsList = ({ records, onBackup, onRestore, onClear, onDelete, onEdit }) => (
          <div id="tour-list" className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
               <div className="bg-slate-50/50 p-4 border-b border-slate-100 flex justify-between items-center">
                  <h3 className="font-bold text-slate-700 text-sm flex items-center gap-2"><Icon name="FileText" size={18} className="text-slate-400"/> سوابق دوره</h3>
                  <div className="flex gap-2">
                      <button onClick={onBackup} className="text-slate-500 hover:text-blue-600 hover:bg-blue-50 p-2 rounded-lg transition-colors" title="دانلود بکاپ"><Icon name="Download" size={18}/></button>
                      <label className="text-slate-500 hover:text-green-600 hover:bg-green-50 p-2 rounded-lg cursor-pointer transition-colors" title="بازگردانی بکاپ"><Icon name="Upload" size={18}/><input type="file" className="hidden" accept=".json" onChange={onRestore}/></label>
                      <button onClick={onClear} className="text-slate-500 hover:text-red-600 hover:bg-red-50 p-2 rounded-lg transition-colors" title="حذف کل"><Icon name="Trash2" size={18}/></button>
                  </div>
               </div>
               <div className="overflow-x-auto">
                   <table className="w-full text-sm text-right whitespace-nowrap">
                       <thead className="bg-slate-50 text-slate-500 border-b border-slate-100">
                           <tr>
                               <th className="p-4 font-bold">تاریخ</th>
                               <th className="p-4 font-bold">شیفت</th>
                               <th className="p-4 font-bold text-center">زمان (24h)</th>
                               <th className="p-4 font-bold text-center">مدت</th>
                               <th className="p-4 font-bold">توضیحات/جانشین</th>
                               <th className="p-4 font-bold text-center">عملیات</th>
                           </tr>
                       </thead>
                       <tbody className="divide-y divide-slate-50">
                           {records.length === 0 ? (
                               <tr><td colSpan="6" className="p-10 text-center text-slate-400 flex flex-col items-center justify-center gap-2"><Icon name="FileText" size={48} className="opacity-20"/>هنوز رکوردی ثبت نشده است</td></tr>
                           ) : (
                               records.sort((a,b) => {
                                   if (a.date.jy !== b.date.jy) return b.date.jy - a.date.jy;
                                   if (a.date.jm !== b.date.jm) return b.date.jm - a.date.jm;
                                   return b.date.jd - a.date.jd;
                               }).map(record => (
                                   <tr key={record.id} className={`hover:bg-slate-50 transition-colors ${record.isHolidayBonus ? 'bg-red-50/30' : ''}`}>
                                       <td className="p-4 font-bold text-slate-700">{formatJalaliNoYear(record.date)}</td>
                                       <td className="p-4 text-xs text-slate-500">{record.shiftName}</td>
                                       <td className="p-4 font-mono text-xs text-center text-slate-600" dir="ltr">{record.startTime} - {record.endTime}</td>
                                       <td className="p-4 font-bold text-blue-600 text-center">{record.duration}</td>
                                       <td className="p-4 text-xs text-slate-400 max-w-[200px]">
                                           <div className="flex flex-col gap-1">
                                              {record.isNonRoutine && <div className="flex items-center gap-1 text-amber-600 bg-amber-50 w-fit px-1.5 py-0.5 rounded text-[10px] font-bold border border-amber-100"><Icon name="Flag" size={10}/> غیر روتین</div>}
                                              {record.isHolidayBonus && <div className="flex items-center gap-1 text-red-600 bg-red-50 w-fit px-1.5 py-0.5 rounded text-[10px] font-bold border border-red-100"><Icon name="Gift" size={10}/> تعطیلات رسمی</div>}
                                              <span className="truncate">{record.substitute || record.description || '-'}</span>
                                           </div>
                                       </td>
                                       <td className="p-4 text-center flex justify-center gap-2">
                                           <button onClick={() => onEdit(record)} className="text-slate-400 hover:text-blue-500 hover:bg-blue-50 p-2 rounded-lg transition-colors"><Icon name="Edit" size={16}/></button>
                                           <button onClick={() => onDelete(record.id)} className="text-slate-400 hover:text-red-500 hover:bg-red-50 p-2 rounded-lg transition-colors"><Icon name="Trash2" size={16}/></button>
                                       </td>
                                   </tr>
                               ))
                           )}
                       </tbody>
                   </table>
               </div>
          </div>
        );

        const Footer = ({ version }) => (
          <footer className="fixed bottom-0 w-full bg-slate-900/90 backdrop-blur text-slate-400 text-center py-3 text-xs border-t border-slate-700/50 z-40">
            <div className="flex flex-col items-center gap-1.5">
              <div className="flex items-center gap-2">
                 <span>برنامه نویسی شده توسط جواد ابراهیمی</span>
                 <span className="text-slate-600">|</span>
                 <a href="https://wa.me/+989120929125" className="text-emerald-500 hover:text-emerald-400 font-mono transition-colors" dir="ltr">+98 912 092 9125</a>
              </div>
              <span className="text-[10px] opacity-40 font-mono flex items-center gap-1"><span>نسخه</span><span>{version}</span></span>
            </div>
          </footer>
        );

        /* =========================================
           MAIN APP
           ========================================= */

        const App = () => {
          const [version] = useState("2.7.0");
          const [view, setView] = useState('main'); 
          const [section, setSection] = useState('factory');
          const [shiftType, setShiftType] = useState('day');
          const [twoShiftMode, setTwoShiftMode] = useState('morning');
          const [baseDateJalali, setBaseDateJalali] = useState(null); 
          const [maxOvertime, setMaxOvertime] = useState(120);
          const [isPremium, setIsPremium] = useState(false);
          const [showPaymentModal, setShowPaymentModal] = useState(false);
          const [showTutorial, setShowTutorial] = useState(false);
          const [activeTourStep, setActiveTourStep] = useState(0);
          const [records, setRecords] = useState([]);
          const [selectedDate, setSelectedDate] = useState(getTodayJalali());
          const [startTime, setStartTime] = useState('07:00'); 
          const [endTime, setEndTime] = useState('16:00');   
          const [substitute, setSubstitute] = useState('');
          const [description, setDescription] = useState('');
          const [isNonRoutine, setIsNonRoutine] = useState(false);
          const [isHolidayBonus, setIsHolidayBonus] = useState(false);
          const [editingId, setEditingId] = useState(null);
          const [modal, setModal] = useState({ isOpen: false, type: null, data: null });
          const [aiModalOpen, setAiModalOpen] = useState(false);
          const [aiContent, setAiContent] = useState("");
          const [aiLoading, setAiLoading] = useState(false);
          const [descLoading, setDescLoading] = useState(false);

          const tourSteps = [
            { target: 'tour-settings-btn', title: 'تنظیمات اولیه', desc: 'برای شروع کار، ابتدا از این قسمت اطلاعات شیفت و واحد کاری خود را تنظیم کنید.', icon: 'Settings' },
            { target: 'tour-help-btn', title: 'راهنمای برنامه', desc: 'هر زمان نیاز به راهنمایی داشتید، می‌توانید مجدداً این تور آموزشی را از اینجا مشاهده کنید.', icon: 'HelpCircle' },
            { target: 'tour-dashboard', title: 'داشبورد وضعیت', desc: 'خلاصه کارکرد ماهانه، باقیمانده مجاز و هشدارهای سیستم در این کارت نمایش داده می‌شود.', icon: 'CheckCircle' },
            { target: 'tour-date-picker', title: 'انتخاب تاریخ', desc: 'تاریخ مورد نظر را انتخاب کنید. سیستم به صورت هوشمند شیفت آن روز را به شما نمایش می‌دهد.', icon: 'Calendar' },
            { target: 'tour-form', title: 'ثبت اطلاعات', desc: 'ساعت شروع و پایان را وارد کنید. سیستم تداخل شیفت و قوانین اضافه کار را بررسی می‌کند.', icon: 'Clock' },
            { target: 'tour-submit-btn', title: 'ذخیره سازی', desc: 'پس از وارد کردن اطلاعات، با زدن این دکمه اضافه کاری شما در لیست پایین ثبت می‌شود.', icon: 'Save' },
            { target: 'tour-list', title: 'مدیریت سوابق', desc: 'لیست تمام اضافه کاری‌های ثبت شده در اینجا قرار دارد. امکان ویرایش، حذف و تهیه نسخه پشتیبان وجود دارد.', icon: 'FileText' }
          ];

          const calculateShiftForDate = useMemo(() => {
            return (jDate) => {
              if (!baseDateJalali) return { name: "تعیین نشده", type: "unknown" };
              const gDateObj = jalaali.toGregorian(jDate.jy, jDate.jm, jDate.jd);
              const targetDate = new Date(gDateObj.gy, gDateObj.gm - 1, gDateObj.gd, 12, 0, 0);
              const gBaseObj = jalaali.toGregorian(baseDateJalali.jy, baseDateJalali.jm, baseDateJalali.jd);
              const anchorDate = new Date(gBaseObj.gy, gBaseObj.gm - 1, gBaseObj.gd, 12, 0, 0);
              const diffTime = targetDate.getTime() - anchorDate.getTime();
              const diffDays = Math.round(diffTime / (1000 * 60 * 60 * 24));
              const mod = (n, m) => ((n % m) + m) % m;

              if (shiftType === 'day') return { name: "روزکار", type: "day", dayOfWeek: targetDate.getDay() };
              if (shiftType === '2shift') {
                let effectiveDay = diffDays;
                if (twoShiftMode === 'afternoon') effectiveDay += 7;
                const cycleDay = mod(effectiveDay, 14);
                if (cycleDay < 7) return { name: "شیفت صبح", type: "morning", dayOfWeek: targetDate.getDay() };
                return { name: "شیفت عصر", type: "afternoon", dayOfWeek: targetDate.getDay() };
              }
              if (shiftType === '4shift') {
                const cycleDay = mod(diffDays, 12);
                if (cycleDay < 3) return { name: "شیفت عصر", type: "afternoon" };
                if (cycleDay < 6) return { name: "شیفت صبح", type: "morning" };
                if (cycleDay < 9) {
                    return { 
                        name: "شیفت شب", 
                        type: "night", 
                        isFirstNight: cycleDay === 6,
                        isOtherNight: cycleDay > 6 
                    };
                }
                return { name: "استراحت", type: "rest", isFirstRest: cycleDay === 9 };
              }
              if (shiftType === '5shift') {
                const cycleDay = mod(diffDays, 10);
                if (cycleDay < 2) return { name: "شیفت عصر", type: "afternoon" };
                if (cycleDay < 4) return { name: "شیفت صبح", type: "morning" };
                if (cycleDay < 6) {
                    return { 
                        name: "شیفت شب", 
                        type: "night", 
                        isFirstNight: cycleDay === 4,
                        isOtherNight: cycleDay > 4 
                    };
                }
                return { name: "استراحت", type: "rest", isFirstRest: cycleDay === 6 };
              }
              return { name: "ناشناخته", type: "unknown" };
            };
          }, [baseDateJalali, shiftType, twoShiftMode]);

          const currentShift = useMemo(() => calculateShiftForDate(selectedDate), [selectedDate, calculateShiftForDate]);

          useEffect(() => {
            const savedRecords = localStorage.getItem('alumina_records');
            const savedSettings = localStorage.getItem('alumina_settings_v3');
            const premiumStatus = localStorage.getItem('alumina_premium');
            const tutorialSeen = localStorage.getItem('alumina_tutorial_seen_v2');
            
            if (savedRecords) setRecords(JSON.parse(savedRecords));
            if (premiumStatus === 'true') setIsPremium(true);
            
            if (savedSettings) {
              const settings = JSON.parse(savedSettings);
              setSection(settings.section || 'factory');
              setShiftType(settings.shiftType || 'day');
              setTwoShiftMode(settings.twoShiftMode || 'morning');
              setBaseDateJalali(settings.baseDateJalali || null);
              setMaxOvertime(settings.maxOvertime || 120);
              
              if (!settings.baseDateJalali) setView('settings');
              else if (!tutorialSeen) { setShowTutorial(true); localStorage.setItem('alumina_tutorial_seen_v2', 'true'); }
            } else {
              setBaseDateJalali(getTodayJalali());
              setView('settings');
            }
          }, []);

          useEffect(() => { localStorage.setItem('alumina_records', JSON.stringify(records)); }, [records]);
          useEffect(() => { localStorage.setItem('alumina_settings_v3', JSON.stringify({ section, shiftType, twoShiftMode, baseDateJalali, maxOvertime })); }, [section, shiftType, twoShiftMode, baseDateJalali, maxOvertime]);
          useEffect(() => { localStorage.setItem('alumina_premium', isPremium); }, [isPremium]);
          
          // Auto-set time based on rules
          useEffect(() => { 
              const dayOfWeek = currentShift.dayOfWeek;
              const isWeekend = dayOfWeek === 4 || dayOfWeek === 5; // Thu or Fri

              if (isHolidayBonus || isWeekend || currentShift.type === 'rest' || (currentShift.type === 'night' && currentShift.isFirstNight)) {
                 // Holidays/Rest/First Night/Weekends for day/2shift -> Morning OT
                 setStartTime('07:00'); setEndTime('16:00');
              } else if ((currentShift.type === 'day' || currentShift.type === 'morning') && !isWeekend) {
                 // Normal Work Day
                 const start = section === 'factory' ? '16:00' : '15:00';
                 setStartTime(start); setEndTime('23:00');
              } else if (currentShift.type === 'afternoon' && !isWeekend) {
                 // Normal Afternoon Work Day
                 setStartTime('07:00'); setEndTime('15:00');
              }
          }, [isHolidayBonus, currentShift, section, shiftType]);

          const calculateDuration = (start, end) => {
            if (!start || !end) return 0;
            const [h1, m1] = start.split(':').map(Number);
            const [h2, m2] = end.split(':').map(Number);
            let minutes = (h2 * 60 + m2) - (h1 * 60 + m1);
            if (minutes < 0) minutes += 24 * 60; 
            return Math.round((minutes / 60) * 100) / 100;
          };

          const checkShiftOverlap = (start, end) => {
              if (!start || !end || isHolidayBonus) return false;
              
              // For Day Shift and 2-Shift, Thursdays and Fridays are treated as holidays/rest days (no overlap check)
              if ((shiftType === 'day' || shiftType === '2shift') && (currentShift.dayOfWeek === 4 || currentShift.dayOfWeek === 5)) {
                  return false;
              }

              const toMins = (time) => { const [h, m] = time.split(':').map(Number); return h * 60 + m; };
              const startMins = toMins(start); const endMins = toMins(end);
              let shiftStart = -1, shiftEnd = -1;

              if (currentShift.type === 'day' || currentShift.type === 'morning') {
                  shiftStart = 420; // 07:00
                  shiftEnd = 960;   // 16:00
              } else if (currentShift.type === 'afternoon') {
                  shiftStart = 900; shiftEnd = (shiftType === '2shift') ? 1410 : 1380; // 15:00 to 23:00/23:30
              } else if (currentShift.type === 'night') {
                  shiftStart = 1380; shiftEnd = 420;
              }
              if (shiftStart === -1) return false; 

              if (currentShift.type === 'night') {
                  const overlapsLate = (startMins < 1440 && endMins > 1380) || (startMins >= 1380);
                  const overlapsEarly = (startMins < 420) || (endMins > 0 && endMins <= 420);
                  if (startMins > endMins) return true; 
                  return overlapsLate || overlapsEarly;
              } else {
                  if (startMins > endMins) return (startMins < shiftEnd) || (0 < shiftEnd && shiftStart < endMins); 
                  return (startMins < shiftEnd && endMins > shiftStart);
              }
          };

          const checkOverlap = (start, end) => {
              const toMins = (t) => { const [h, m] = t.split(':').map(Number); return h * 60 + m; };
              let startMins = toMins(start); let endMins = toMins(end);
              if (endMins <= startMins) endMins += 1440;
              return records.some(r => {
                  if (r.date.jy === selectedDate.jy && r.date.jm === selectedDate.jm && r.date.jd === selectedDate.jd) {
                      if (editingId && r.id === editingId) return false;
                      let rStart = toMins(r.startTime); let rEnd = toMins(r.endTime);
                      if (rEnd <= rStart) rEnd += 1440;
                      return (startMins < rEnd && endMins > rStart);
                  }
                  return false;
              });
          };

          const handlePaymentSuccess = () => {
              setIsPremium(true);
              setShowPaymentModal(false);
              setModal({
                  isOpen: true,
                  type: 'alert',
                  message: "پرداخت با موفقیت انجام شد! نسخه کامل برای شما فعال گردید."
              });
          };

          const handleAIAnalyze = async () => {
              if (records.length === 0) {
                  setModal({ isOpen: true, type: 'alert', message: "هنوز رکوردی ثبت نشده است. لطفاً ابتدا چند مورد اضافه کاری ثبت کنید." });
                  return;
              }
              setAiModalOpen(true);
              setAiLoading(true);
              const summary = records.map(r => 
                  `تاریخ: ${formatJalaliNoYear(r.date)}، شیفت: ${r.shiftName}، مدت: ${r.duration} ساعت`
              ).join('\n');
              
              const prompt = `تو یک دستیار هوشمند منابع انسانی برای شرکت آلومینا ایران هستی. لطفاً این لیست اضافه کاری کارمند را تحلیل کن و یک گزارش خلاصه به زبان فارسی بده.
              لیست رکوردها:
              ${summary}
              
              مواردی که باید در تحلیل باشد:
              1. مجموع کل ساعات.
              2. تحلیل توزیع شیفت‌ها (چقدر شب‌کاری یا تعطیل‌کاری داشته).
              3. یک توصیه دوستانه و کوتاه برای تعادل کار و زندگی.
              پاسخ را با فرمت مارک‌داون تمیز و بولت‌وار بده.`;

              const response = await callGemini(prompt);
              setAiContent(response);
              setAiLoading(false);
          };

          const handleAIGenerateDesc = async () => {
              setDescLoading(true);
              const prompt = `یک متن کوتاه و رسمی اداری به زبان فارسی برای قسمت توضیحات فرم اضافه کاری بنویس.
              اطلاعات:
              تاریخ: ${formatJalaliNoYear(selectedDate)}
              ساعت: ${startTime} تا ${endTime}
              شیفت: ${currentShift.name}
              نوع: ${isHolidayBonus ? 'تعطیل رسمی' : 'عادی'}
              
              فقط متن خروجی را بده بدون هیچ توضیحات اضافه‌ای. مثلا: "انجام امور محوله در شیفت شب..."`;
              
              const text = await callGemini(prompt);
              setDescription(text.trim());
              setDescLoading(false);
          };

          const changeBaseDate = (days) => {
              const current = baseDateJalali || getTodayJalali();
              const gObj = jalaali.toGregorian(current.jy, current.jm, current.jd);
              const date = new Date(gObj.gy, gObj.gm - 1, gObj.gd, 12, 0, 0);
              date.setDate(date.getDate() + days);
              setBaseDateJalali(jalaali.toJalaali(date.getFullYear(), date.getMonth() + 1, date.getDate()));
          };

          const handleAddRecord = () => {
            if (!isPremium && !editingId && records.length >= 3) { setShowPaymentModal(true); return; }
            if (isHolidayBonus) {
                // Holiday Bonus is now available for all shifts based on user feedback
                const hasHoliday = records.some(r => r.date.jy === selectedDate.jy && r.date.jm === selectedDate.jm && r.date.jd === selectedDate.jd && r.isHolidayBonus && r.id !== editingId);
                if (hasHoliday) { setModal({ isOpen: true, type: 'alert', message: "خطا: برای هر روز فقط یک رکورد تعطیلات رسمی می‌توان ثبت کرد." }); return; }
                const workDuration = calculateDuration(startTime, endTime);
                let totalDuration = workDuration;
                if (currentShift.type === 'rest' || ((shiftType === 'day' || shiftType === '2shift') && (currentShift.dayOfWeek === 4 || currentShift.dayOfWeek === 5))) {
                    totalDuration += 8;
                }
                saveRecord(totalDuration, description || 'تعطیل رسمی');
                return;
            }
            if (checkShiftOverlap(startTime, endTime)) { setModal({ isOpen: true, type: 'alert', message: `تداخل با شیفت کاری! \nشما در این تاریخ ${currentShift.name} هستید و نمی‌توانید در ساعات شیفت موظفی، اضافه کاری ثبت کنید.` }); return; }
            if (checkOverlap(startTime, endTime)) { setModal({ isOpen: true, type: 'alert', message: "اخطار: تداخل زمانی با رکوردهای ثبت شده وجود دارد. لطفا ساعت را بررسی کنید." }); return; }
            const [startH] = startTime.split(':').map(Number);
            
            // Logic for Day/2Shift Normal Days
            if ((shiftType === 'day' || (shiftType === '2shift' && currentShift.type === 'morning')) && (currentShift.dayOfWeek !== 4 && currentShift.dayOfWeek !== 5)) {
                 const limitHour = section === 'factory' ? 16 : 15;
                 if (startH < limitHour) { setModal({ isOpen: true, type: 'alert', message: `خطا: در روزهای عادی (شنبه تا چهارشنبه)، اضافه کاری باید بعد از ساعت پایان کار (${limitHour}:۰۰) باشد.` }); return; }
            }
            
            if ((currentShift.isOtherNight || currentShift.isFirstRest) && !isNonRoutine) {
                if (startH < 9) {
                     setModal({ 
                        isOpen: true, 
                        type: 'alert', 
                        message: `اخطار: در ${currentShift.name}، اضافه کاری قبل از ساعت ۰۹:۰۰ صبح نیازمند مجوز سرپرست (تیک غیر روتین) است.` 
                    });
                    return;
                }
            }

            saveRecord(calculateDuration(startTime, endTime), description);
          };

          const saveRecord = (duration, desc) => {
            const newRecord = { id: editingId || Date.now(), date: selectedDate, startTime, endTime, duration, shiftName: currentShift.name, substitute, description: desc, isNonRoutine, isHolidayBonus, type: 'manual' };
            if (editingId) { setRecords(records.map(r => r.id === editingId ? newRecord : r)); setEditingId(null); } 
            else setRecords([...records, newRecord]);
            setStartTime('07:00'); setEndTime('16:00'); setSubstitute(''); setDescription(''); setIsNonRoutine(false); setIsHolidayBonus(false);
          };

          const getCurrentCycleRecords = () => {
            let startSearch, endSearch;
            if (selectedDate.jd > 20) {
               let nextM = selectedDate.jm + 1; let nextY = selectedDate.jy;
               if (nextM > 12) { nextM = 1; nextY++; }
               startSearch = { jy: selectedDate.jy, jm: selectedDate.jm, jd: 21 };
               endSearch = { jy: nextY, jm: nextM, jd: 20 };
            } else {
               let prevM = selectedDate.jm - 1; let prevY = selectedDate.jy;
               if (prevM < 1) { prevM = 12; prevY--; }
               startSearch = { jy: prevY, jm: prevM, jd: 21 };
               endSearch = { jy: selectedDate.jy, jm: selectedDate.jm, jd: 20 };
            }
            const isWithin = (rDate) => {
                const rVal = rDate.jy * 10000 + rDate.jm * 100 + rDate.jd;
                const sVal = startSearch.jy * 10000 + startSearch.jm * 100 + startSearch.jd;
                const eVal = endSearch.jy * 10000 + endSearch.jm * 100 + endSearch.jd;
                return rVal >= sVal && rVal <= eVal;
            };
            return records.filter(r => isWithin(r.date));
          };

          const currentCycleRecords = getCurrentCycleRecords();
          const totalHours = useMemo(() => {
            let sum = currentCycleRecords.reduce((acc, curr) => acc + curr.duration, 0);
            if (shiftType === '4shift' || shiftType === '5shift') sum += 5;
            return Math.round(sum * 100) / 100;
          }, [currentCycleRecords, shiftType]);

          const changeDate = (days) => {
            const gObj = jalaali.toGregorian(selectedDate.jy, selectedDate.jm, selectedDate.jd);
            const date = new Date(gObj.gy, gObj.gm - 1, gObj.gd, 12, 0, 0);
            date.setDate(date.getDate() + days);
            setSelectedDate(jalaali.toJalaali(date.getFullYear(), date.getMonth() + 1, date.getDate()));
          };

          const handleEdit = (record) => { setSelectedDate(record.date); setStartTime(record.startTime); setEndTime(record.endTime); setSubstitute(record.substitute); setDescription(record.description); setIsNonRoutine(record.isNonRoutine); setIsHolidayBonus(record.isHolidayBonus || false); setEditingId(record.id); };
          const requestDelete = (id) => setModal({ isOpen: true, type: 'delete_one', data: id, message: "آیا از حذف این رکورد اطمینان دارید؟" });
          const requestClearAll = () => setModal({ isOpen: true, type: 'delete_all', message: "آیا مطمئن هستید که می‌خواهید تمام سوابق را پاک کنید؟" });
          const confirmAction = () => { if (modal.type === 'delete_one') setRecords(records.filter(r => r.id !== modal.data)); else if (modal.type === 'delete_all') setRecords([]); setModal({ isOpen: false, type: null, data: null }); };
          const closeModal = () => setModal({ isOpen: false, type: null, data: null });
          const handleBackup = () => { const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(records)); const a = document.createElement('a'); a.href = dataStr; a.download = "backup_alumina.json"; document.body.appendChild(a); a.click(); a.remove(); };
          const handleRestore = (e) => { const reader = new FileReader(); reader.readAsText(e.target.files[0], "UTF-8"); reader.onload = evt => { try { setRecords(JSON.parse(evt.target.result)); alert("بازگردانی شد"); } catch { alert("فایل نامعتبر"); } }; };

          if (view === 'settings') {
            return (
              <div className="min-h-screen bg-slate-50 flex flex-col justify-center items-center p-4" dir="rtl">
                <div className="max-w-md w-full bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-100">
                    <div className="bg-slate-900 p-8 text-white text-center relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-orange-500 via-yellow-400 to-orange-500"></div>
                        <div className="absolute -right-10 -top-10 w-32 h-32 bg-white/5 rounded-full blur-2xl"></div>
                        <div className="mx-auto mb-4 text-orange-400 opacity-90 relative z-10 w-12 h-12 flex justify-center items-center"><Icon name="Settings" size={48} /></div>
                        <h2 className="text-2xl font-black tracking-tight relative z-10">تنظیمات سامانه</h2>
                    </div>
                    <div className="p-6 space-y-6">
                        <div>
                            <label className="block text-sm font-bold text-slate-700 mb-3 flex items-center gap-2"><Icon name="Briefcase" size={18} className="text-blue-500"/> مجموعه کاری</label>
                            <div className="grid grid-cols-2 gap-3">
                                <button onClick={() => setSection('factory')} className={`flex flex-col items-center justify-center p-4 rounded-xl border-2 transition-all duration-200 ${section === 'factory' ? 'border-blue-500 bg-blue-50/50 text-blue-700 font-bold shadow-md' : 'border-slate-100 bg-white text-slate-500 hover:border-slate-200 hover:bg-slate-50'}`}><Icon name="Factory" size={24} className="mb-2" strokeWidth={1.5}/>کارخانه</button>
                                <button onClick={() => setSection('ingot')} className={`flex flex-col items-center justify-center p-4 rounded-xl border-2 transition-all duration-200 ${section === 'ingot' ? 'border-blue-500 bg-blue-50/50 text-blue-700 font-bold shadow-md' : 'border-slate-100 bg-white text-slate-500 hover:border-slate-200 hover:bg-slate-50'}`}><Icon name="Layers" size={24} className="mb-2" strokeWidth={1.5}/>شمش</button>
                            </div>
                        </div>
                        <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">نوع شیفت</label>
                            <select value={shiftType} onChange={(e) => setShiftType(e.target.value)} className="w-full p-3.5 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none appearance-none text-slate-700 font-medium transition-colors">
                                <option value="day">روزکار (عادی)</option>
                                <option value="2shift">دو شیفت (هفته‌ای)</option>
                                <option value="4shift">چهار شیفت</option>
                                {section === 'ingot' && <option value="5shift">پنج شیفت</option>}
                            </select>
                        </div>
                        {shiftType === '2shift' && (
                            <div className="bg-blue-50/50 p-4 rounded-xl border border-blue-100 animate-in fade-in slide-in-from-top-2">
                                <label className="block text-xs font-bold text-blue-800 mb-3">وضعیت شیفت در تاریخ مبنا:</label>
                                <div className="flex gap-2">
                                    <button onClick={() => setTwoShiftMode('morning')} className={`flex-1 flex items-center justify-center gap-2 py-2 rounded-lg text-xs font-bold transition-colors ${twoShiftMode === 'morning' ? 'bg-white text-orange-600 shadow border border-orange-100' : 'text-slate-500 hover:bg-white/50'}`}><Icon name="Sunrise" size={16}/> هفته صبح‌کار</button>
                                    <button onClick={() => setTwoShiftMode('afternoon')} className={`flex-1 flex items-center justify-center gap-2 py-2 rounded-lg text-xs font-bold transition-colors ${twoShiftMode === 'afternoon' ? 'bg-white text-indigo-600 shadow border border-indigo-100' : 'text-slate-500 hover:bg-white/50'}`}><Icon name="Sunset" size={16}/> هفته عصرکار</button>
                                </div>
                            </div>
                        )}
                        <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2 flex justify-between"><span>سقف اضافه کاری</span><span className="text-blue-600 font-mono bg-blue-50 px-2 rounded">{maxOvertime} ساعت</span></label>
                            <input type="range" min="50" max="120" step="1" value={maxOvertime} onChange={(e) => setMaxOvertime(Number(e.target.value))} className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600"/>
                        </div>
                        <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">تاریخ شروع سیکل (مبنا)</label>
                            <div className="flex items-center justify-between bg-slate-50 p-2 rounded-xl border border-slate-100 shadow-inner">
                                 <button onClick={() => changeBaseDate(-1)} className="w-10 h-10 flex items-center justify-center bg-white shadow-sm rounded-lg hover:bg-slate-100 text-slate-600 transition-colors"><Icon name="ChevronRight" size={20}/></button>
                                 <JalaliDatePicker value={baseDateJalali || getTodayJalali()} onChange={setBaseDateJalali} startYear={1400} endYear={1410}/>
                                 <button onClick={() => changeBaseDate(1)} className="w-10 h-10 flex items-center justify-center bg-white shadow-sm rounded-lg hover:bg-slate-100 text-slate-600 transition-colors"><Icon name="ChevronLeft" size={20}/></button>
                            </div>
                            <div className="text-xs text-orange-600 mt-3 bg-orange-50 p-3 rounded-xl border border-orange-100 flex items-start gap-2 leading-5"><Icon name="AlertTriangle" size={16} className="min-w-[16px] mt-0.5"/><p>برای محاسبه صحیح، تاریخی را وارد کنید که <strong>اولین روز شروع سیکل</strong> (مثلاً اولین روز عصرکاری) شما بوده است.</p></div>
                        </div>
                        <button onClick={() => { if (!baseDateJalali) return alert("تاریخ مبنا را انتخاب کنید"); setView('main'); }} className="w-full py-4 bg-slate-900 hover:bg-slate-800 text-white font-bold rounded-xl shadow-lg shadow-slate-200 transition-all active:scale-95 flex items-center justify-center gap-2"><Icon name="CheckCircle" size={20} />تایید و ورود</button>
                    </div>
                </div>
              </div>
            );
          }

          const isWarning = totalHours >= (maxOvertime * 0.83) && totalHours < maxOvertime;
          const isDanger = totalHours >= maxOvertime;

          return (
            <div className="min-h-screen bg-slate-50 pb-20 font-sans text-slate-800" dir="rtl">
              <a href="https://wa.me/+989120929125" target="_blank" rel="noreferrer" className="fixed bottom-6 left-6 z-50 bg-green-500 text-white p-3.5 rounded-full shadow-xl shadow-green-500/30 hover:bg-green-600 transition-all hover:scale-110 flex items-center justify-center"><WhatsAppIcon /></a>
              
              <PaymentModal isOpen={showPaymentModal} onClose={() => setShowPaymentModal(false)} onSuccess={handlePaymentSuccess} />
              <AIModal isOpen={aiModalOpen} onClose={() => setAiModalOpen(false)} content={aiContent} loading={aiLoading} />
              <ConfirmModal isOpen={modal.isOpen && modal.type !== 'alert'} title={modal.type === 'delete_all' ? "حذف کل" : "حذف رکورد"} message={modal.message} onConfirm={confirmAction} onCancel={closeModal} />
              {modal.isOpen && modal.type === 'alert' && (
                 <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 text-center animate-in zoom-in duration-200">
                        <div className="w-16 h-16 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mx-auto mb-4"><Icon name="AlertTriangle" size={32} /></div>
                        <p className="text-gray-800 font-bold mb-6 whitespace-pre-wrap">{modal.message}</p>
                        <button onClick={closeModal} className="w-full py-3 bg-slate-900 text-white rounded-xl font-bold">بسیار عالی</button>
                    </div>
                 </div>
              )}

              <TourGuide steps={tourSteps} activeStep={activeTourStep} isOpen={showTutorial} onClose={() => setShowTutorial(false)} onNext={() => setActiveTourStep(p => Math.min(p + 1, tourSteps.length - 1))} onPrev={() => setActiveTourStep(p => Math.max(p - 1, 0))} />

              <Header section={section} isPremium={isPremium} onSettingsClick={() => setView('settings')} onPaymentClick={() => !isPremium && setShowPaymentModal(true)} onHelpClick={() => { setActiveTourStep(0); setShowTutorial(true); }} />

              <main className="max-w-4xl mx-auto p-4 space-y-5">
                <Dashboard totalHours={totalHours} maxOvertime={maxOvertime} shiftType={shiftType} isWarning={isWarning} isDanger={isDanger} recordCount={records.length} isPremium={isPremium} onAIAnalyze={handleAIAnalyze} />
                <RecordForm selectedDate={selectedDate} currentShift={currentShift} startTime={startTime} endTime={endTime} substitute={substitute} description={description} isNonRoutine={isNonRoutine} isHolidayBonus={isHolidayBonus} editingId={editingId} shiftType={shiftType} onChangeDate={changeDate} onDateSelect={setSelectedDate} setStartTime={setStartTime} setEndTime={setEndTime} setSubstitute={setSubstitute} setDescription={setDescription} setIsNonRoutine={setIsNonRoutine} setIsHolidayBonus={setIsHolidayBonus} onSave={handleAddRecord} onAIGenerateDesc={handleAIGenerateDesc} loadingDesc={descLoading} />
                <RecordsList records={currentCycleRecords} onBackup={handleBackup} onRestore={handleRestore} onClear={requestClearAll} onDelete={requestDelete} onEdit={handleEdit} />
              </main>

              <Footer version={version} />
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
